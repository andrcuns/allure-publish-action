name: "allure-publish-action"
description: "Publish allure report to cloud provider"
author: "Andrejs"
branding:
  icon: "book-open"
  color: "yellow"
inputs:
  storageType:
    required: true
    description: "Cloud storage type"
  bucket:
    required: true
    description: "Bucket name"
  resultsGlob:
    required: false
    description: "Allure results files glob"
  prefix:
    required: false
    description: "Optional prefix for report path"
  baseUrl:
    required: false
    description: "Custom report base url"
  updatePr:
    required: false
    description: "Add result summary (pr or actions summary)"
    default: "actions"
  config:
    required: false
    description: "Path to custom allure configuration file"
  addSummary:
    required: false
    description: "Add summary section to PR comment or actions summary"
    default: "true"
  collapseSummary:
    required: false
    description: "Create summary table as a collapsible section"
  reportTitle:
    required: false
    description: "Title for PR comment/description section"
  copyLatest:
    required: false
    description: "Keep copy of latest report at base prefix path"
  ignoreMissingResults:
    required: false
    description: "Ignore missing allure results"
  flakyWarningStatus:
    required: false
    description: "Use '!' status emoji when flaky tests are present in report"
  color:
    required: false
    description: "Force color output"
    default: "true"
  debug:
    required: false
    description: "Add debug log output"
    default: "false"
  parallel:
    required: false
    description: "Number of parallel threads to use for report file upload to cloud storage"
    default: "8"
  reportName:
    required: false
    description: "Custom report name"
    default: "Test Report"
runs:
  using: docker
  image: Dockerfile
  args:
    - --results-glob=${{ inputs.resultsGlob }}
    - --bucket=${{ inputs.bucket }}
    - --prefix=${{ inputs.prefix }}
    - --update-pr=${{ inputs.updatePr }}
    - --add-summary=${{ inputs.addSummary }}
    - --collapse-summary=${{ inputs.collapseSummary }}
    - --ci-report-title=${{ inputs.reportTitle }}
    - --copy-latest=${{ inputs.copyLatest }}
    - --ignore-missing-results=${{ inputs.ignoreMissingResults }}
    - --flaky-warning-status=${{ inputs.flakyWarningStatus }}
    - --color=${{ inputs.color }}
    - --base-url=${{ inputs.baseUrl }}
    - --debug=${{ inputs.debug }}
    - --parallel=${{ inputs.parallel }}
    - --config=${{ inputs.config }}
    - ${{ inputs.storageType }}
